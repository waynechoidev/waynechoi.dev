<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/_next/static/css/2e2a7597edf4d608.css" crossorigin="" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/602feae4669a507e.css" crossorigin="" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-c25d000de3a6a081.js" crossorigin=""/><script src="/_next/static/chunks/fd9d1056-33f88dcb8cab817d.js" async="" crossorigin=""></script><script src="/_next/static/chunks/472-c5427e31248623a0.js" async="" crossorigin=""></script><script src="/_next/static/chunks/main-app-998ad79e34130139.js" async="" crossorigin=""></script><script src="/_next/static/chunks/326-6784f49434136418.js" async=""></script><script src="/_next/static/chunks/app/layout-a7d9660fe841e21f.js" async=""></script><script src="/_next/static/chunks/691-d72542b099e0bc41.js" async=""></script><script src="/_next/static/chunks/app/post/%5Bslug%5D/page-e90f3bafd107b713.js" async=""></script><title>WayneChoi.Dev</title><meta name="description" content="Wayne Choi blog"/><link rel="icon" href="/favicon.ico"/><script src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js" crossorigin="" noModule=""></script></head><body class="mx-auto my-0"><nav class="max-w-default mx-auto px-5 py-3"><div class="flex justify-end"><a href="/about/"><span class="hover:font-bold pl-3 text-lg font-normal">About</span></a><a href="/posts/"><span class="hover:font-bold pl-3 text-lg font-normal">Posts</span></a></div></nav><header><div class="h-32 relative" id="sky"><canvas class="w-full h-full"></canvas><div class="absolute top-0 inset-x-auto w-full "><div class="w-full max-w-default mx-auto"><h1 class="text-4xl font-semibold p-5 pt-0"><a class="text-blue-800" href="/">WayneChoi.dev</a></h1></div></div></div></header><div class="max-w-default mx-auto p-5"><div><a class="text-gray-600 text-md pl-1 hover:font-bold" href="/posts/graphics/">GRAPHICS</a><h1>Level of detail</h1><p class="text-gray-400 text-sm m-0 mt-1">March 10, 2024</p><div class="mt-1"><div class="whitespace-nowrap overflow-x-auto pb-3"><a class="mr-2 text-gray-500 hover:font-bold" href="/tag/opengl/">#opengl</a><a class="mr-2 text-gray-500 hover:font-bold" href="/tag/levelofdetail/">#levelofdetail</a><a class="mr-2 text-gray-500 hover:font-bold" href="/tag/tessellation/">#tessellation</a><a class="mr-2 text-gray-500 hover:font-bold" href="/tag/mipmap/">#mipmap</a></div></div><div class="mt-8"><div class="flex flex-col justify-center"></div></div><div><div></div></div></div></div><footer class="h-40 flex justify-center items-end"><p class="text-gray-500 text-sm">(C) 2021. Wayne Choi. All rights reserved.</p></footer><script src="/_next/static/chunks/webpack-c25d000de3a6a081.js" crossorigin="" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/css/2e2a7597edf4d608.css\",\"style\",{\"crossOrigin\":\"\"}]\n0:\"$L2\"\n"])</script><script>self.__next_f.push([1,"3:HL[\"/_next/static/css/602feae4669a507e.css\",\"style\",{\"crossOrigin\":\"\"}]\n"])</script><script>self.__next_f.push([1,"4:I[3728,[],\"\"]\n6:I[9928,[],\"\"]\n7:I[9194,[\"326\",\"static/chunks/326-6784f49434136418.js\",\"185\",\"static/chunks/app/layout-a7d9660fe841e21f.js\"],\"\"]\n8:I[5629,[\"326\",\"static/chunks/326-6784f49434136418.js\",\"185\",\"static/chunks/app/layout-a7d9660fe841e21f.js\"],\"\"]\n9:I[6954,[],\"\"]\na:I[7264,[],\"\"]\nc:I[8326,[\"326\",\"static/chunks/326-6784f49434136418.js\",\"691\",\"static/chunks/691-d72542b099e0bc41.js\",\"605\",\"static/chunks/app/post/%5Bslug%5D/page-e90f3bafd107b713.js\"],\"\"]\nd:I[7708,[\"326\",\"static/chunks/326-6784f494341"])</script><script>self.__next_f.push([1,"36418.js\",\"691\",\"static/chunks/691-d72542b099e0bc41.js\",\"605\",\"static/chunks/app/post/%5Bslug%5D/page-e90f3bafd107b713.js\"],\"\"]\nf:I[5631,[\"326\",\"static/chunks/326-6784f49434136418.js\",\"691\",\"static/chunks/691-d72542b099e0bc41.js\",\"605\",\"static/chunks/app/post/%5Bslug%5D/page-e90f3bafd107b713.js\"],\"\"]\ne:T22ec,"])</script><script>self.__next_f.push([1,"\nLevel of Detail (LOD) is a crucial concept in computer graphics and game development, utilized to optimize rendering performance while maintaining visual fidelity. LOD techniques dynamically adjust the complexity of objects based on factors such as viewer distance, screen size, or importance within the scene. I implemented several LOD techniques directly using OpenGL.\n\n---\n\n## Tesselation Shader\n\nTessellation involves automatically subdividing an object's surface to add or reduce detail. To implement LOD using tessellation shaders, it's primarily divided into two stages: the control shader and the evaluation shader. Let's discuss these two shaders.\n\n### Control Shader\n\nThe control shader takes vertex data of the object as input. It determines the tessellation level based on LOD and generates new vertices to be passed to the tessellation shader. It dynamically sets the tessellation level to adjust the geometry detail of the object according to LOD.\n\n```cpp\n#version 420 core\n\nlayout (vertices = 3) out;\n\nvoid main() {\n    int scale = // set the detail level\n\n    gl_TessLevelOuter[0] = scale; // left for quads\n    gl_TessLevelOuter[1] = scale; // bot for quads\n    gl_TessLevelOuter[2] = scale; // right for quads\n    gl_TessLevelOuter[3] = scale; // top for quads\n\n    gl_TessLevelInner[0] = scale; // top bot for quads\n    gl_TessLevelInner[1] = scale; // left right for quads\n}\n```\n\n### Evaluation Shader\n\nThe evaluation shader takes as input the new vertices generated by the control shader. It evaluates the surface of the tessellated object and renders the new vertices. It ensures that the tessellated object's geometry detail is appropriately adjusted for rendering.\n\n```cpp\n#version 420 core\n\nlayout(triangles, equal_spacing, cw) in;\n\nvoid main() {\n  gl_Position = gl_TessCoord.x * gl_in[0].gl_Position +\n                gl_TessCoord.y * gl_in[1].gl_Position +\n                gl_TessCoord.z * gl_in[2].gl_Position;\n}\n```\n\nWhen implementing LOD using tessellation shaders, you typically write these two shaders. The control shader determines the tessellation level based on LOD and generates new vertices to be passed to the evaluation shader. This allows for dynamically adjusting the geometry detail of objects using tessellation shaders.\n\nAdditionally, it's crucial to render primitives as patches when using tessellation. I overlooked this detail and spent a lot of time troubleshooting errors.\n\nYou can see LOD using tessellation in action in the video below. LOD has been exaggerated for explanatory purposes, but it's not typically this extreme in actual products.\n\n\u003ciframe width=\"560\" height=\"315\" src=\"https://www.youtube.com/embed/xeJxZ5evPsE?si=2SXREbfjzSR3mU7y\" title=\"YouTube video player\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" allowfullscreen\u003e\u003c/iframe\u003e\n\n---\n\n## Mesh swap\n\nUsing mesh swap for LOD implementation involves preparing separate meshes for each LOD level in advance and dynamically replacing the mesh with the appropriate LOD level based on distance or visibility. This method is primarily handled by the CPU and offers the advantage of reducing GPU load.\n\nSpecifically, different meshes must be prepared in advance for each LOD level. For example, prepare meshes with varying levels of detail such as LOD1, LOD2, LOD3, and so on. These pre-prepared meshes are then dynamically swapped out for the appropriate LOD level based on distance.\n\nThe implementation steps are as follows:\n\n1. Prepare meshes for multiple levels of LOD, such as LOD1, LOD2, LOD3, etc.\n2. Measure the distance between the camera and the object, and determine the appropriate LOD level based on this distance.\n3. Render the object using the selected mesh corresponding to the determined LOD level.\n4. Update the LOD level and swap the mesh whenever the distance or visibility changes.\n\nBelow is a brief example implementing mesh swap for LOD. I've omitted irrelevant parts for brevity.\n\n```cpp\nint main()\n{\n\tWindow mainWindow = Window(1920, 1080);\n\tmainWindow.initialise();\n\n\tSphere sphere_1 = Sphere(1.0f, 30, 30);\n\tsphere_1.initialise();\n\n\tSphere sphere_2 = Sphere(1.0f, 20, 20);\n\tsphere_2.initialise();\n\n\tSphere sphere_3 = Sphere(1.0f, 10, 10);\n\tsphere_3.initialise();\n\n\tSphere sphere_4 = Sphere(1.0f, 5, 5);\n\tsphere_4.initialise();\n\n\t// Model\n\tglm::vec3 translation = glm::vec3(0.0f);\n\tglm::vec3 scaling = glm::vec3(0.7f);\n\tglm::vec3 rotation = {0.4f, 2.5f, 0.0f};\n\n    ...\n\n\twhile (!mainWindow.getShouldClose())\n\t{\n\n\t...\n\n\t\tif (translation.z \u003e -1)\n\t\t\tsphere_1.draw();\n\t\telse if (translation.z \u003e -2)\n\t\t\tsphere_2.draw();\n\t\telse if (translation.z \u003e -3)\n\t\t\tsphere_3.draw();\n\t\telse\n\t\t\tsphere_4.draw();\n\n    ...\n\n\t}\n\n\treturn 0;\n}\n```\n\nUsing this method, CPU manages LOD and swaps meshes, thereby reducing GPU load. However, it requires preparing various LOD meshes in advance and additional management logic for LOD transitions. A downside is the increase in memory usage. Most commercial game engines like Unreal Engine and Unity implement LOD using this approach.\n\nYou can observe LOD with mesh swap in action in the video below. LOD has been exaggerated for explanatory purposes, but it's not typically this extreme in actual products.\n\n\u003ciframe width=\"560\" height=\"315\" src=\"https://www.youtube.com/embed/NaoF8sa1Udg?si=qobD_5N9z6jnL-bJ\" title=\"YouTube video player\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" allowfullscreen\u003e\u003c/iframe\u003e\n\n---\n\n## Mipmap\n\nIn most cases, LOD is used to adjust the level of geometric detail. However, the LOD concept is also utilized in texture mapping, known as mipmapping, to enhance rendering quality by adjusting the texture resolution.\n\nLOD using mipmaps involves applying different resolutions of textures to reduce detail for objects that are far away. This is primarily used to improve performance by reducing the detail of textures that are distant.\n\nSpecifically, mipmaps involve pre-generating and storing various resolution versions of textures. Multiple resolutions of textures, higher than the original resolution, are prepared. These prepared mipmaps are utilized during texture mapping. When an object is far away, the texture's resolution applied to that object is switched to a lower resolution version from the mipmap.\n\nMipmaps typically provide a functionality where various resolution versions of textures are automatically generated by the graphics API, rather than being prepared manually by developers. Therefore, developers only need to consider mipmaps during texture creation. Below is the texture creation method that I used when implementing mipmaps.\n\n```cpp\nvoid Texture::initialise(std::string fileLoc)\n{\n\tunsigned char *texData = stbi_load(fileLoc.c_str(), \u0026_width, \u0026_height, \u0026_bitDepth, 0);\n\n\tglGenTextures(1, \u0026_textureID);\n\tglBindTexture(GL_TEXTURE_2D, _textureID);\n\n\t// Set texture parameters and generate mipmaps\n\tglTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_S, GL_REPEAT);\n\tglTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_T, GL_REPEAT);\n\tglTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR_MIPMAP_LINEAR);\n\tglTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_LINEAR);\n\n\t// Load texture data and generate mipmaps\n\tif (_bitDepth == 3)\n\t{\n\t\tglTexImage2D(GL_TEXTURE_2D, 0, GL_RGB, _width, _height, 0, GL_RGB, GL_UNSIGNED_BYTE, texData);\n\t}\n\telse if (_bitDepth == 4)\n\t{\n\t\tglTexImage2D(GL_TEXTURE_2D, 0, GL_RGBA, _width, _height, 0, GL_RGBA, GL_UNSIGNED_BYTE, texData);\n\t}\n\tglGenerateMipmap(GL_TEXTURE_2D);\n\n\tglBindTexture(GL_TEXTURE_2D, 0);\n\n\tstbi_image_free(texData);\n}\n```\n\n---\n\nThe above video demonstrates the simultaneous application of LOD based on geometric level and mipmaps. LOD has been exaggerated for explanatory purposes, but it's not typically this extreme in actual products.\n\n\u003ciframe width=\"560\" height=\"315\" src=\"https://www.youtube.com/embed/uXcf-MrRKBE?si=Wk-HblygMDMWqNV-\" title=\"YouTube video player\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" allowfullscreen\u003e\u003c/iframe\u003e\n\n---\n\nThe provided codes have been abstracted or simplified for explanatory purposes. For detailed code and implementation, you can refer to the repository links below\n\n[Repo with tessellation](https://github.com/waynechoidev/level-of-detail-with-tessellation) / [Repo with mesh swap](https://github.com/waynechoidev/level-of-detail-with-mesh-swap)\n\n---\n\n### References\n\n- [Wikipedia - Level of detail](\u003chttps://en.wikipedia.org/wiki/Level_of_detail_(computer_graphics)\u003e)\n- [UE5 - Creating and Using LODs](https://docs.unrealengine.com/5.3/en-US/creating-and-using-lods-in-unreal-engine/)\n- [Unity - Level of Detail (LOD) for meshes](https://docs.unity3d.com/Manual/LevelOfDetail.html)\n- [Unity - Importing LOD Meshes](https://docs.unity3d.com/2021.2/Documentation/Manual/importing-lod-meshes.html)\n"])</script><script>self.__next_f.push([1,"2:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/2e2a7597edf4d608.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]],[\"$\",\"$L4\",null,{\"buildId\":\"66G0aB6dfbyOKQbJ7yBQJ\",\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/post/level-of-detail/\",\"initialTree\":[\"\",{\"children\":[\"post\",{\"children\":[[\"slug\",\"level-of-detail\",\"d\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":\\\"level-of-detail\\\"}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialHead\":[false,\"$L5\"],\"globalErrorComponent\":\"$6\",\"children\":[null,[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"className\":\"mx-auto my-0\",\"children\":[[\"$\",\"nav\",null,{\"className\":\"max-w-default mx-auto px-5 py-3\",\"children\":[\"$\",\"$L7\",null,{}]}],[\"$\",\"header\",null,{\"children\":[\"$\",\"$L8\",null,{}]}],[\"$\",\"div\",null,{\"className\":\"max-w-default mx-auto p-5\",\"children\":[\"$\",\"$L9\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":[],\"childProp\":{\"current\":[\"$\",\"$L9\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"post\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[null,[\"$\",\"$L9\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"post\",\"children\",[\"slug\",\"level-of-detail\",\"d\"],\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[\"$Lb\",[\"$\",\"div\",null,{\"children\":[[\"$\",\"$Lc\",null,{\"href\":\"/posts/graphics\",\"className\":\"text-gray-600 text-md pl-1 hover:font-bold\",\"children\":\"GRAPHICS\"}],[\"$\",\"h1\",null,{\"children\":\"Level of detail\"}],[\"$\",\"p\",null,{\"className\":\"text-gray-400 text-sm m-0 mt-1\",\"children\":\"March 10, 2024\"}],[\"$\",\"div\",null,{\"className\":\"mt-1\",\"children\":[\"$\",\"div\",null,{\"className\":\"whitespace-nowrap overflow-x-auto pb-3\",\"children\":[[\"$\",\"$Lc\",\"opengl\",{\"href\":\"/tag/opengl\",\"className\":\"mr-2 text-gray-500 hover:font-bold\",\"children\":\"#opengl\"}],[\"$\",\"$Lc\",\"levelofdetail\",{\"href\":\"/tag/levelofdetail\",\"className\":\"mr-2 text-gray-500 hover:font-bold\",\"children\":\"#levelofdetail\"}],[\"$\",\"$Lc\",\"tessellation\",{\"href\":\"/tag/tessellation\",\"className\":\"mr-2 text-gray-500 hover:font-bold\",\"children\":\"#tessellation\"}],[\"$\",\"$Lc\",\"mipmap\",{\"href\":\"/tag/mipmap\",\"className\":\"mr-2 text-gray-500 hover:font-bold\",\"children\":\"#mipmap\"}]]}]}],[\"$\",\"div\",null,{\"className\":\"mt-8\",\"children\":[\"$\",\"$Ld\",null,{\"content\":\"$e\"}]}],[\"$\",\"$Lf\",null,{\"issueTerm\":\"Level of detail\"}]]}],null],\"segment\":\"__PAGE__?{\\\"slug\\\":\\\"level-of-detail\\\"}\"},\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/602feae4669a507e.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]]}],null],\"segment\":[\"slug\",\"level-of-detail\",\"d\"]},\"styles\":[]}],\"segment\":\"post\"},\"styles\":[]}]}],[\"$\",\"footer\",null,{\"className\":\"h-40 flex justify-center items-end\",\"children\":[\"$\",\"p\",null,{\"className\":\"text-gray-500 text-sm\",\"children\":\"(C) 2021. Wayne Choi. All rights reserved.\"}]}]]}]}],null]}]]\n"])</script><script>self.__next_f.push([1,"5:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"1\",{\"children\":\"WayneChoi.Dev\"}],[\"$\",\"meta\",\"2\",{\"name\":\"description\",\"content\":\"Wayne Choi blog\"}],[\"$\",\"meta\",\"3\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"link\",\"4\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\"}]]\nb:null\n"])</script></body></html>