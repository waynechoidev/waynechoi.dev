<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/_next/static/css/c7afeb134dd1cb93.css" crossorigin="" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/602feae4669a507e.css" crossorigin="" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-1a36ed48f9eaac65.js" crossorigin=""/><script src="/_next/static/chunks/fd9d1056-33f88dcb8cab817d.js" async="" crossorigin=""></script><script src="/_next/static/chunks/472-c5427e31248623a0.js" async="" crossorigin=""></script><script src="/_next/static/chunks/main-app-998ad79e34130139.js" async="" crossorigin=""></script><script src="/_next/static/chunks/326-6784f49434136418.js" async=""></script><script src="/_next/static/chunks/app/layout-8dd766f55875cf30.js" async=""></script><script src="/_next/static/chunks/691-d72542b099e0bc41.js" async=""></script><script src="/_next/static/chunks/app/post/%5Bslug%5D/page-d950cea58624c07c.js" async=""></script><title>WayneChoi.Dev</title><meta name="description" content="Wayne Choi blog"/><link rel="icon" href="/favicon.ico"/><script src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js" crossorigin="" noModule=""></script></head><body class="mx-auto my-0"><nav class="max-w-default mx-auto px-5 py-3"><div class="flex justify-end"><a href="/about/"><span class="hover:font-bold pl-3 text-lg font-normal">About</span></a><a href="/posts/"><span class="hover:font-bold pl-3 text-lg font-normal">Posts</span></a></div></nav><header><div class="h-32 relative" id="sky"><canvas class="w-full h-full"></canvas><div class="absolute top-0 inset-x-auto w-full "><div class="w-full max-w-default mx-auto"><h1 class="text-4xl font-semibold p-5 pt-0"><a class="text-blue-800" href="/">WayneChoi.dev</a></h1></div></div></div></header><div class="max-w-default mx-auto p-5"><div><a class="text-gray-600 text-md pl-1 hover:font-bold" href="/posts/web/">WEB</a><h1>Immutability (2) - Immutable.js, pros and cons</h1><p class="text-gray-400 text-sm m-0 mt-1">Oct 14, 2021</p><div class="mt-1"><div class="whitespace-nowrap overflow-x-auto pb-3"><a class="mr-2 text-gray-500 hover:font-bold" href="/tag/javascript/">#javascript</a><a class="mr-2 text-gray-500 hover:font-bold" href="/tag/immutability/">#immutability</a></div></div><div class="mt-8"><div></div></div></div></div><footer class="h-40 flex justify-center items-end"><p class="text-gray-500 text-sm">(C) 2021. Wayne Choi. All rights reserved.</p></footer><script src="/_next/static/chunks/webpack-1a36ed48f9eaac65.js" crossorigin="" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/css/c7afeb134dd1cb93.css\",\"style\",{\"crossOrigin\":\"\"}]\n0:\"$L2\"\n"])</script><script>self.__next_f.push([1,"3:HL[\"/_next/static/css/602feae4669a507e.css\",\"style\",{\"crossOrigin\":\"\"}]\n"])</script><script>self.__next_f.push([1,"4:I[3728,[],\"\"]\n6:I[9928,[],\"\"]\n7:I[9194,[\"326\",\"static/chunks/326-6784f49434136418.js\",\"185\",\"static/chunks/app/layout-8dd766f55875cf30.js\"],\"\"]\n8:I[5629,[\"326\",\"static/chunks/326-6784f49434136418.js\",\"185\",\"static/chunks/app/layout-8dd766f55875cf30.js\"],\"\"]\n9:I[6954,[],\"\"]\na:I[7264,[],\"\"]\nc:I[8326,[\"326\",\"static/chunks/326-6784f49434136418.js\",\"691\",\"static/chunks/691-d72542b099e0bc41.js\",\"605\",\"static/chunks/app/post/%5Bslug%5D/page-d950cea58624c07c.js\"],\"\"]\nd:I[7708,[\"326\",\"static/chunks/326-6784f494341"])</script><script>self.__next_f.push([1,"36418.js\",\"691\",\"static/chunks/691-d72542b099e0bc41.js\",\"605\",\"static/chunks/app/post/%5Bslug%5D/page-d950cea58624c07c.js\"],\"\"]\ne:T12d6,"])</script><script>self.__next_f.push([1,"\n### Immutability series\n\n1. [Object.freeze() doesn't always freeze](/post/immutability_object_freeze_doesnt_always_freeze)\n2. **Immutable.js, pros and cons**\n\n---\n\nWe need to keep original data to avoid side effects. If it is primitive data type, there is nothing to care about. If it is an object, we normally copy and manipulate it to keep the original data immutable. In this way, we might get problem when we deal with large data.\n\nTo keep the original object, we need to deep copy it. It means we need to allocate the space in memory for the entire object, even all of the stuff that didn't change. The both time and space complexity will be so bad. The code runs slow.\n\nThere are many of libraries to solve this problem, and I picked Immutable.js. It is a library to support immutable data structure, supported by Facebook. I would explain how it deal with immutability efficiently, and its disadvantages.\n\n---\n\n## How Immutable.js works\n\n```js\nconst { Map } = require(\"immutable\");\n\nconst map1 = Map({ a: 1, b: 2, c: 3 });\nconst map2 = map1.set(\"b\", 50);\n\nconsole.log(map1.get(\"b\")); // 2\nconsole.log(map2.get(\"b\")); // 50\nconsole.log(map1 == map2); // false\n```\n\nI made map1 object, then executed map1.set to change a value with key \"b\". It did not change a value of key \"b\" in map1, but returned new object, map2, with new value of key \"b\".\n\nIt looks like copying whole object and change one value, but worked totally different inside. Map1 and map2 objects are sharing values just except the changed value to minimize consuming memory. It is implemented by persistent data structures.\n\n---\n\n```js\nconst { fromJS } = require(\"immutable\");\n\nconst nested = fromJS({ a: { b: { c: [3, 4, 5] } } });\nconst nested2 = nested.mergeDeep({ a: { b: { d: 6 } } });\n// Map { a: Map { b: Map { c: List [ 3, 4, 5 ], d: 6 } } }\n\nconsole.log(nested);\n// Map { a: Map { b: Map { c: List [ 3, 4, 5 ] } } }\nconsole.log(nested2);\n// Map { a: Map { b: Map { c: List [ 3, 4, 5 ], d: 6 } } }\nconsole.log(nested == nested2); // false\n```\n\nThe collections in Immutable.js are intended to be nested, allowing for deep trees of data, similar to JSON.\n\n---\n\n## Persistent data structures\n\nIn computing, a persistent data structure is a data structure that always preserves the previous version of itself when it is modified. Such data structures are effectively immutable, as their operations do not (visibly) update the structure in-place, but instead always yield a new updated structure.\n\nIt is commonly used in functional programming to enforce immutability. Many of languages with functional programming paradigm has implementations of persistent data structures, but JavaScript does not. Immutable.js is a library to support this to JavaScript.\n\nIt is optimized with trie data structure. I will provide an example below to understand easily.\n\n---\n\n```js\nconst data = {\n  to: 7,\n  tea: 3,\n  ted: 4,\n  ten: 12,\n  A: 15,\n  i: 11,\n  in: 5,\n  inn: 9,\n};\n```\n\n\u003cimg src=\"/img/immutability_immutable_js_pros_and_cons-1.png\" class=\"post-pic\"\u003e\n\nI made an JS object, and created a trie with same keys and values. A trie is a type of tree where the leaves hold the values, and the paths from the root to the values represent the keys. So I can access a value by traversing the tree to get one letter at a time.\n\n---\n\n\u003cimg src=\"/img/immutability_immutable_js_pros_and_cons-2.png\" class=\"post-pic\"\u003e\n\nFor example, if I want to get a value with a key, 'ted', I can start from root, and follow the paths represented 't', 'e', and 'd'. I arrived at a node that contains 4.\n\n---\n\n\u003cimg src=\"/img/immutability_immutable_js_pros_and_cons-3.png\" class=\"post-pic\"\u003e\n\nI changed the value at the key 'ted' from 4 to 8. Other nodes are still used. With this structures, only few nodes are recreated when we change a single item,\n\n---\n\n## Disadvantages of Immutable.js\n\nAll the data structure implemented with Immutable.js are custom object. It means it is not JSON format. JSON is widely used format to communicate. If we use custom objects like data structures of Immutable.js, we need to convert them to JSON format first. It consumes time and memory, and it is a huge consumption when data is large.\n\nIn addition, we cannot use methods of Object and Array object in Immutable.js data structures. It raises the running curve, and dependency to a specific library.\n\n---\n\n### References\n\n- [Anjana Vakil: Immutable data structures for functional JS | JSConf EU](https://youtu.be/Wo0qiGPSV-s)\n- [Wikipedia](https://en.wikipedia.org/wiki/Persistent_data_structure#Trees)\n- [Immutable.js](https://immutable-js.com/)\n- [How Immutable Data Structures (E.g. Immutable.js) are Optimized](https://hackernoon.com/how-immutable-data-structures-e-g-immutable-js-are-optimized-using-structural-sharing-e4424a866d56)\n- 함수형 자바스크립트 프로그래밍 - 유인동\n"])</script><script>self.__next_f.push([1,"2:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/c7afeb134dd1cb93.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]],[\"$\",\"$L4\",null,{\"buildId\":\"2vH3S8PiNNNiKNtU8iawL\",\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/post/immutability_immutable_js_pros_and_cons/\",\"initialTree\":[\"\",{\"children\":[\"post\",{\"children\":[[\"slug\",\"immutability_immutable_js_pros_and_cons\",\"d\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":\\\"immutability_immutable_js_pros_and_cons\\\"}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialHead\":[false,\"$L5\"],\"globalErrorComponent\":\"$6\",\"children\":[null,[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"className\":\"mx-auto my-0\",\"children\":[[\"$\",\"nav\",null,{\"className\":\"max-w-default mx-auto px-5 py-3\",\"children\":[\"$\",\"$L7\",null,{}]}],[\"$\",\"header\",null,{\"children\":[\"$\",\"$L8\",null,{}]}],[\"$\",\"div\",null,{\"className\":\"max-w-default mx-auto p-5\",\"children\":[\"$\",\"$L9\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":[],\"childProp\":{\"current\":[\"$\",\"$L9\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"post\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[null,[\"$\",\"$L9\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"post\",\"children\",[\"slug\",\"immutability_immutable_js_pros_and_cons\",\"d\"],\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[\"$Lb\",[\"$\",\"div\",null,{\"children\":[[\"$\",\"$Lc\",null,{\"href\":\"/posts/web\",\"className\":\"text-gray-600 text-md pl-1 hover:font-bold\",\"children\":\"WEB\"}],[\"$\",\"h1\",null,{\"children\":\"Immutability (2) - Immutable.js, pros and cons\"}],[\"$\",\"p\",null,{\"className\":\"text-gray-400 text-sm m-0 mt-1\",\"children\":\"Oct 14, 2021\"}],[\"$\",\"div\",null,{\"className\":\"mt-1\",\"children\":[\"$\",\"div\",null,{\"className\":\"whitespace-nowrap overflow-x-auto pb-3\",\"children\":[[\"$\",\"$Lc\",\"javascript\",{\"href\":\"/tag/javascript\",\"className\":\"mr-2 text-gray-500 hover:font-bold\",\"children\":\"#javascript\"}],[\"$\",\"$Lc\",\"immutability\",{\"href\":\"/tag/immutability\",\"className\":\"mr-2 text-gray-500 hover:font-bold\",\"children\":\"#immutability\"}]]}]}],[\"$\",\"div\",null,{\"className\":\"mt-8\",\"children\":[\"$\",\"$Ld\",null,{\"content\":\"$e\"}]}]]}],null],\"segment\":\"__PAGE__?{\\\"slug\\\":\\\"immutability_immutable_js_pros_and_cons\\\"}\"},\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/602feae4669a507e.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]]}],null],\"segment\":[\"slug\",\"immutability_immutable_js_pros_and_cons\",\"d\"]},\"styles\":[]}],\"segment\":\"post\"},\"styles\":[]}]}],[\"$\",\"footer\",null,{\"className\":\"h-40 flex justify-center items-end\",\"children\":[\"$\",\"p\",null,{\"className\":\"text-gray-500 text-sm\",\"children\":\"(C) 2021. Wayne Choi. All rights reserved.\"}]}]]}]}],null]}]]\n"])</script><script>self.__next_f.push([1,"5:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"1\",{\"children\":\"WayneChoi.Dev\"}],[\"$\",\"meta\",\"2\",{\"name\":\"description\",\"content\":\"Wayne Choi blog\"}],[\"$\",\"meta\",\"3\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"link\",\"4\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\"}]]\nb:null\n"])</script></body></html>