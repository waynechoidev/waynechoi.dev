<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/_next/static/css/2e2a7597edf4d608.css" crossorigin="" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/602feae4669a507e.css" crossorigin="" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-c25d000de3a6a081.js" crossorigin=""/><script src="/_next/static/chunks/fd9d1056-33f88dcb8cab817d.js" async="" crossorigin=""></script><script src="/_next/static/chunks/472-c5427e31248623a0.js" async="" crossorigin=""></script><script src="/_next/static/chunks/main-app-998ad79e34130139.js" async="" crossorigin=""></script><script src="/_next/static/chunks/326-6784f49434136418.js" async=""></script><script src="/_next/static/chunks/app/layout-a7d9660fe841e21f.js" async=""></script><script src="/_next/static/chunks/691-d72542b099e0bc41.js" async=""></script><script src="/_next/static/chunks/app/post/%5Bslug%5D/page-e90f3bafd107b713.js" async=""></script><title>WayneChoi.Dev</title><meta name="description" content="Wayne Choi blog"/><link rel="icon" href="/favicon.ico"/><script src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js" crossorigin="" noModule=""></script></head><body class="mx-auto my-0"><nav class="max-w-default mx-auto px-5 py-3"><div class="flex justify-end"><a href="/about/"><span class="hover:font-bold pl-3 text-lg font-normal">About</span></a><a href="/posts/"><span class="hover:font-bold pl-3 text-lg font-normal">Posts</span></a></div></nav><header><div class="h-32 relative" id="sky"><canvas class="w-full h-full"></canvas><div class="absolute top-0 inset-x-auto w-full "><div class="w-full max-w-default mx-auto"><h1 class="text-4xl font-semibold p-5 pt-0"><a class="text-blue-800" href="/">WayneChoi.dev</a></h1></div></div></div></header><div class="max-w-default mx-auto p-5"><div><a class="text-gray-600 text-md pl-1 hover:font-bold" href="/posts/graphics/">GRAPHICS</a><h1>Mouse picking with Frame Buffer</h1><p class="text-gray-400 text-sm m-0 mt-1">Nov 2, 2023</p><div class="mt-1"><div class="whitespace-nowrap overflow-x-auto pb-3"><a class="mr-2 text-gray-500 hover:font-bold" href="/tag/opengl/">#opengl</a><a class="mr-2 text-gray-500 hover:font-bold" href="/tag/framebuffer/">#framebuffer</a><a class="mr-2 text-gray-500 hover:font-bold" href="/tag/picking/">#picking</a><a class="mr-2 text-gray-500 hover:font-bold" href="/tag/cpp/">#cpp</a></div></div><div class="mt-8"><div class="flex flex-col justify-center"></div></div><div><div></div></div></div></div><footer class="h-40 flex justify-center items-end"><p class="text-gray-500 text-sm">(C) 2021. Wayne Choi. All rights reserved.</p></footer><script src="/_next/static/chunks/webpack-c25d000de3a6a081.js" crossorigin="" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/css/2e2a7597edf4d608.css\",\"style\",{\"crossOrigin\":\"\"}]\n0:\"$L2\"\n"])</script><script>self.__next_f.push([1,"3:HL[\"/_next/static/css/602feae4669a507e.css\",\"style\",{\"crossOrigin\":\"\"}]\n"])</script><script>self.__next_f.push([1,"4:I[3728,[],\"\"]\n6:I[9928,[],\"\"]\n7:I[9194,[\"326\",\"static/chunks/326-6784f49434136418.js\",\"185\",\"static/chunks/app/layout-a7d9660fe841e21f.js\"],\"\"]\n8:I[5629,[\"326\",\"static/chunks/326-6784f49434136418.js\",\"185\",\"static/chunks/app/layout-a7d9660fe841e21f.js\"],\"\"]\n9:I[6954,[],\"\"]\na:I[7264,[],\"\"]\nc:I[8326,[\"326\",\"static/chunks/326-6784f49434136418.js\",\"691\",\"static/chunks/691-d72542b099e0bc41.js\",\"605\",\"static/chunks/app/post/%5Bslug%5D/page-e90f3bafd107b713.js\"],\"\"]\nd:I[7708,[\"326\",\"static/chunks/326-6784f494341"])</script><script>self.__next_f.push([1,"36418.js\",\"691\",\"static/chunks/691-d72542b099e0bc41.js\",\"605\",\"static/chunks/app/post/%5Bslug%5D/page-e90f3bafd107b713.js\"],\"\"]\nf:I[5631,[\"326\",\"static/chunks/326-6784f49434136418.js\",\"691\",\"static/chunks/691-d72542b099e0bc41.js\",\"605\",\"static/chunks/app/post/%5Bslug%5D/page-e90f3bafd107b713.js\"],\"\"]\ne:T141c,"])</script><script>self.__next_f.push([1,"\n\u003ciframe width=\"560\" height=\"315\" src=\"https://www.youtube.com/embed/9DOjirWzVe4?si=MsVCXpoV4rfBZ4qR\" title=\"YouTube video player\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" allowfullscreen\u003e\u003c/iframe\u003e\n\nI have implemented mouse picking using OpenGL. I used the Frame Buffer Object (FBO) to detect collisions for picking. FBO is a powerful feature in OpenGL that allows you to render a scene to a texture rather than the default framebuffer. This capability is crucial for various purposes, including off-screen rendering, post-processing effects, and even General-Purpose computing on Graphics Processing Units (GPGPU). In the context of mouse picking, rendering the scene to an FBO enables us to easily retrieve pixel information, which in turn helps us identify objects under the mouse cursor during mouse picking operations.\n\n---\n\nFirst, I generated and bound a Frame Buffer (FBO). Then, I created and bound a texture. By attaching the texture to the FBO, the FBO could store rendering results in memory instead of displaying them directly on the screen. This allowed me to perform rendering operations for other purposes, such as off-screen rendering or post-processing, without directly affecting what was visible on the screen. This separation between rendering and displaying provided greater flexibility in graphics and computation tasks.\n\n```cpp\nGLuint framebuffer;\nglGenFramebuffers(1, \u0026framebuffer);\nglBindFramebuffer(GL_FRAMEBUFFER, framebuffer);\nGLuint texture;\nglGenTextures(1, \u0026texture);\nglBindTexture(GL_TEXTURE_2D, texture);\nglTexImage2D(GL_TEXTURE_2D, 0, GL_RGB, WIDTH, HEIGHT, 0, GL_RGB, GL_UNSIGNED_BYTE, NULL);\nglTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR);\nglTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_LINEAR);\nglFramebufferTexture2D(GL_FRAMEBUFFER, GL_COLOR_ATTACHMENT0, GL_TEXTURE_2D, texture, 0);\nglBindTexture(GL_TEXTURE_2D, 0);\nglBindFramebuffer(GL_FRAMEBUFFER, 0);\n\n```\n\n---\n\nAt this stage, I ensured that the shader had the necessary information by providing it with two crucial uniforms. The first uniform served the purpose of specifying a distinct index color, specifically assigned to individual objects. This color acted as a means of identification, allowing the shader to differentiate between objects efficiently. The second uniform conveyed a boolean value, serving as an indicator of whether the rendering process was occurring off-screen or within the default frame buffer. This distinction was vital for tailoring the shader's behavior and adapting it to the specific rendering context.\n\n```cpp\nGLuint useFBOUniform = glGetUniformLocation(programID, \"useFBO\");\nGLuint indexColorUniform = glGetUniformLocation(programID, \"indexColor\");\n\nglBindFramebuffer(GL_FRAMEBUFFER, framebuffer);\nglUniform1i(useFBOUniform, 1);\nglUniform3f(indexColorUniform, 1.0f, 0.0f, 0.0f);\n\nobject.draw();\n```\n\n---\n\nAt this point, the behavior in the fragment shader is determined by the value of 'useFBO.' As you can see in the code below, if 'useFBO' is true, indicating off-screen rendering, the shader processes the index color as part of the off-screen rendering workflow. On the other hand, if 'useFBO' is false, indicating direct rendering to the screen, the shader switches to an alternative mode.\n\n```glsl\nout vec4 color;\n\nuniform bool useFBO;\nuniform vec3 indexColor;\n\n// res is result for texture and lighting\n\nif(useFBO) color = vec4(indexColor, 1.0);\nelse color = vec4(res, 1.0);\n```\n\n---\n\nWhile the FBO is bound, and objects are being rendered within this context, it's important to note that you have the capability to utilize the 'glReadPixels' function. This function enables you to capture and subsequently retrieve the RGB values of a specific pixel. This color data corresponds to the previously assigned index color, and it plays a fundamental role in the process of identifying the selected object. By reading and decoding the pixel's RGB values, you can accurately determine which object was interactively picked during mouse interactions.\n\n```cpp\nglm::vec2 cursor = mainWindow.getCursor();\nint x = (int)cursor.x;\nint y = (int)cursor.y;\n\nunsigned char pickedColor[3];\nglReadPixels(x, y, 1, 1, GL_RGB, GL_UNSIGNED_BYTE, pickedColor);\n\nglBindFramebuffer(GL_FRAMEBUFFER, 0);\nglUniform1i(useFBOUniform, 0);\n```\n\n---\n\nSubsequently, you can perform various operations by comparing the captured color values from the CPU with the object's index color. I accomplished this by sending a comparison boolean value as a uniform to the shader. When the two values match, the object changes color to the index color. The provided code is a simplified version created for the purpose of understanding, and many details have been omitted. The code available at the repository link below may differ significantly from the code in the main text, as it could include texture mapping, materials, lighting, and some additional abstractions. You can find the code at the repository link for a more comprehensive and detailed implementation.\n\n---\n\n[Repository](https://github.com/waynechoidev/mouse-picking-frame-buffer/)\n"])</script><script>self.__next_f.push([1,"2:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/2e2a7597edf4d608.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]],[\"$\",\"$L4\",null,{\"buildId\":\"E1-KP1G8ch8FSug0JXXYA\",\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/post/mouse-picking-with-frame-buffer/\",\"initialTree\":[\"\",{\"children\":[\"post\",{\"children\":[[\"slug\",\"mouse-picking-with-frame-buffer\",\"d\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":\\\"mouse-picking-with-frame-buffer\\\"}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialHead\":[false,\"$L5\"],\"globalErrorComponent\":\"$6\",\"children\":[null,[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"className\":\"mx-auto my-0\",\"children\":[[\"$\",\"nav\",null,{\"className\":\"max-w-default mx-auto px-5 py-3\",\"children\":[\"$\",\"$L7\",null,{}]}],[\"$\",\"header\",null,{\"children\":[\"$\",\"$L8\",null,{}]}],[\"$\",\"div\",null,{\"className\":\"max-w-default mx-auto p-5\",\"children\":[\"$\",\"$L9\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":[],\"childProp\":{\"current\":[\"$\",\"$L9\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"post\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[null,[\"$\",\"$L9\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"post\",\"children\",[\"slug\",\"mouse-picking-with-frame-buffer\",\"d\"],\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[\"$Lb\",[\"$\",\"div\",null,{\"children\":[[\"$\",\"$Lc\",null,{\"href\":\"/posts/graphics\",\"className\":\"text-gray-600 text-md pl-1 hover:font-bold\",\"children\":\"GRAPHICS\"}],[\"$\",\"h1\",null,{\"children\":\"Mouse picking with Frame Buffer\"}],[\"$\",\"p\",null,{\"className\":\"text-gray-400 text-sm m-0 mt-1\",\"children\":\"Nov 2, 2023\"}],[\"$\",\"div\",null,{\"className\":\"mt-1\",\"children\":[\"$\",\"div\",null,{\"className\":\"whitespace-nowrap overflow-x-auto pb-3\",\"children\":[[\"$\",\"$Lc\",\"opengl\",{\"href\":\"/tag/opengl\",\"className\":\"mr-2 text-gray-500 hover:font-bold\",\"children\":\"#opengl\"}],[\"$\",\"$Lc\",\"framebuffer\",{\"href\":\"/tag/framebuffer\",\"className\":\"mr-2 text-gray-500 hover:font-bold\",\"children\":\"#framebuffer\"}],[\"$\",\"$Lc\",\"picking\",{\"href\":\"/tag/picking\",\"className\":\"mr-2 text-gray-500 hover:font-bold\",\"children\":\"#picking\"}],[\"$\",\"$Lc\",\"cpp\",{\"href\":\"/tag/cpp\",\"className\":\"mr-2 text-gray-500 hover:font-bold\",\"children\":\"#cpp\"}]]}]}],[\"$\",\"div\",null,{\"className\":\"mt-8\",\"children\":[\"$\",\"$Ld\",null,{\"content\":\"$e\"}]}],[\"$\",\"$Lf\",null,{\"issueTerm\":\"Mouse picking with Frame Buffer\"}]]}],null],\"segment\":\"__PAGE__?{\\\"slug\\\":\\\"mouse-picking-with-frame-buffer\\\"}\"},\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/602feae4669a507e.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]]}],null],\"segment\":[\"slug\",\"mouse-picking-with-frame-buffer\",\"d\"]},\"styles\":[]}],\"segment\":\"post\"},\"styles\":[]}]}],[\"$\",\"footer\",null,{\"className\":\"h-40 flex justify-center items-end\",\"children\":[\"$\",\"p\",null,{\"className\":\"text-gray-500 text-sm\",\"children\":\"(C) 2021. Wayne Choi. All rights reserved.\"}]}]]}]}],null]}]]\n"])</script><script>self.__next_f.push([1,"5:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"1\",{\"children\":\"WayneChoi.Dev\"}],[\"$\",\"meta\",\"2\",{\"name\":\"description\",\"content\":\"Wayne Choi blog\"}],[\"$\",\"meta\",\"3\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"link\",\"4\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\"}]]\nb:null\n"])</script></body></html>