<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/_next/static/css/baa01199c04a1a03.css" crossorigin="" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/602feae4669a507e.css" crossorigin="" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-410015a84325bd9d.js" crossorigin=""/><script src="/_next/static/chunks/fd9d1056-33f88dcb8cab817d.js" async="" crossorigin=""></script><script src="/_next/static/chunks/472-c5427e31248623a0.js" async="" crossorigin=""></script><script src="/_next/static/chunks/main-app-998ad79e34130139.js" async="" crossorigin=""></script><script src="/_next/static/chunks/326-6784f49434136418.js" async=""></script><script src="/_next/static/chunks/app/layout-21c5cbba278c1661.js" async=""></script><script src="/_next/static/chunks/691-d72542b099e0bc41.js" async=""></script><script src="/_next/static/chunks/app/post/%5Bslug%5D/page-c6220fba5b22e67b.js" async=""></script><title>WayneChoi.Dev</title><meta name="description" content="Wayne Choi blog"/><link rel="icon" href="/favicon.ico"/><script src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js" crossorigin="" noModule=""></script></head><body class="mx-auto my-0"><nav class="max-w-default mx-auto px-5 py-3"><div class="flex justify-end"><a href="/about/"><span class="hover:font-bold pl-3 text-lg font-normal">About</span></a><a href="/posts/"><span class="hover:font-bold pl-3 text-lg font-normal">Posts</span></a></div></nav><header><div class="h-32 relative" id="sky"><canvas class="w-full h-full"></canvas><div class="absolute top-0 inset-x-auto w-full "><div class="w-full max-w-default mx-auto"><h1 class="text-4xl font-semibold p-5 pt-0"><a class="text-blue-800" href="/">WayneChoi.dev</a></h1></div></div></div></header><div class="max-w-default mx-auto p-5"><div><a class="text-gray-600 text-md pl-1 hover:font-bold" href="/posts/graphics/">GRAPHICS</a><h1>Trackball</h1><p class="text-gray-400 text-sm m-0 mt-1">Nov 10, 2023</p><div class="mt-1"><div class="whitespace-nowrap overflow-x-auto pb-3"><a class="mr-2 text-gray-500 hover:font-bold" href="/tag/opengl/">#opengl</a><a class="mr-2 text-gray-500 hover:font-bold" href="/tag/trackball/">#trackball</a><a class="mr-2 text-gray-500 hover:font-bold" href="/tag/picking/">#picking</a><a class="mr-2 text-gray-500 hover:font-bold" href="/tag/raycasting/">#raycasting</a></div></div><div class="mt-8"><div></div></div><div><div></div></div></div></div><footer class="h-40 flex justify-center items-end"><p class="text-gray-500 text-sm">(C) 2021. Wayne Choi. All rights reserved.</p></footer><script src="/_next/static/chunks/webpack-410015a84325bd9d.js" crossorigin="" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/css/baa01199c04a1a03.css\",\"style\",{\"crossOrigin\":\"\"}]\n0:\"$L2\"\n"])</script><script>self.__next_f.push([1,"3:HL[\"/_next/static/css/602feae4669a507e.css\",\"style\",{\"crossOrigin\":\"\"}]\n"])</script><script>self.__next_f.push([1,"4:I[3728,[],\"\"]\n6:I[9928,[],\"\"]\n7:I[9194,[\"326\",\"static/chunks/326-6784f49434136418.js\",\"185\",\"static/chunks/app/layout-21c5cbba278c1661.js\"],\"\"]\n8:I[5629,[\"326\",\"static/chunks/326-6784f49434136418.js\",\"185\",\"static/chunks/app/layout-21c5cbba278c1661.js\"],\"\"]\n9:I[6954,[],\"\"]\na:I[7264,[],\"\"]\nc:I[8326,[\"326\",\"static/chunks/326-6784f49434136418.js\",\"691\",\"static/chunks/691-d72542b099e0bc41.js\",\"605\",\"static/chunks/app/post/%5Bslug%5D/page-c6220fba5b22e67b.js\"],\"\"]\nd:I[7708,[\"326\",\"static/chunks/326-6784f494341"])</script><script>self.__next_f.push([1,"36418.js\",\"691\",\"static/chunks/691-d72542b099e0bc41.js\",\"605\",\"static/chunks/app/post/%5Bslug%5D/page-c6220fba5b22e67b.js\"],\"\"]\nf:I[5631,[\"326\",\"static/chunks/326-6784f49434136418.js\",\"691\",\"static/chunks/691-d72542b099e0bc41.js\",\"605\",\"static/chunks/app/post/%5Bslug%5D/page-c6220fba5b22e67b.js\"],\"\"]\ne:T2308,"])</script><script>self.__next_f.push([1,"\n\u003ciframe width=\"560\" height=\"315\" src=\"https://www.youtube.com/embed/KQhOrAeFm8A?si=n0SRJXAz3kiEg2eL\" title=\"YouTube video player\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" allowfullscreen\u003e\u003c/iframe\u003e\n\nI have implemented a trackball feature using OpenGL. A trackball enables users to interactively rotate objects within a 3D space, offering an intuitive and engaging user experience. This feature enhances the overall interactivity of the application, allowing for dynamic and visually appealing manipulation of 3D objects.\n\n---\n\n## Picking with ray casting\n\nBefore delving into trackball implementation, it is essential to select the object using the mouse. This process involves detecting collisions between the mouse and the object through ray tracing and determining the point of collision. The initial step is to calculate the ray cast originating from the mouse in world coordinates. To achieve this, I employ ray casting to identify collisions between the mouse and the object, ultimately obtaining the intersection point. The crucial starting point is determining the ray cast originating from the mouse in world coordinates.\n\n---\n\nTransformed the mouse cursor's position from screen space coordinates to normalized device coordinates.\n\n```cpp\n// screen space (viewport coordinates)\nglm::vec2 cursor...\n\n// normalised device space\nGLfloat x = cursor.x * 2.0f / WIDTH - 1.0f;\nGLfloat y = 1.0f - cursor.y * 2.0f / HEIGHT;\nGLfloat z = 1.0f;\nglm::vec3 ray_nds = glm::vec3(x, y, z);\n```\n\n---\n\nTransformed a ray from clip space to eye space. The ray_clip vector is constructed with adjusted z and w components to ensure the ray points into the screen. The transformation to ray_eye involves multiplying by the inverse of the projection matrix. The resulting vector is then modified to fit the eye space representation. Overall, this process prepares the ray for subsequent rendering pipeline stages.\n\n```cpp\n// clip space\nglm::vec4 ray_clip = glm::vec4(ray_nds[0], ray_nds[1], -1.0, 1.0);\n// eye space\nglm::vec4 ray_eye = glm::inverse(projection) * ray_clip;\nray_eye = glm::vec4(ray_eye[0], ray_eye[1], -1.0, 0.0);\n```\n\n---\n\nTransformed the ray from eye space to world space. The ray_eye vector is multiplied by the inverse of the view matrix to achieve this transformation. The resulting vector, ray_wor, represents the ray in world space coordinates. Finally, the vector is normalized to ensure accurate directional information.\n\n```cpp\n// world space\nglm::vec3 ray_wor = glm::vec3(inverse(view) * ray_eye);\nray_wor = glm::normalize(ray_wor);\n```\n\n---\n\nThis function performs a collision test between a ray and an object, referencing code from [https://antongerdelan.net/](https://antongerdelan.net/). The original function returned a boolean indicating collision, but I modified the code to return the intersection point for later use in implementing a trackball. To achieve this, the intersection boolean is now passed by reference, allowing the function to modify its value based on whether a collision occurs. The function is designed to return the intersection point if a collision is detected, facilitating further implementation for trackball functionality.\n\n```cpp\nbool intersection = false;\nglm::vec3 pickPoint = ray_sphere(camera.getPosition(), ray_wor, translation, SPHERE_SCALE, intersection);\n```\n\n```cpp\n// https://github.com/capnramses/antons_opengl_tutorials_book/blob/master/07_ray_picking/main.cpp\nglm::vec3 ray_sphere(glm::vec3 ray_origin_wor, glm::vec3 ray_direction_wor, glm::vec3 sphere_centre_wor, GLfloat sphere_radius, bool\u0026 intersection) {\n\t// work out components of quadratic\n\tglm::vec3 dist_to_sphere = ray_origin_wor - sphere_centre_wor;\n\tGLfloat b = glm::dot(ray_direction_wor, dist_to_sphere);\n\tGLfloat c = glm::dot(dist_to_sphere, dist_to_sphere) - sphere_radius * sphere_radius;\n\tGLfloat b_squared_minus_c = b * b - c;\n\n\t// check for \"imaginary\" answer. == ray completely misses sphere\n\tif (b_squared_minus_c \u003c 0.0f) {\n\t\tintersection = false;\n\t\treturn glm::vec3(0.0f);\n\t}\n\n\t// check for ray hitting twice (in and out of the sphere)\n\tif (b_squared_minus_c \u003e 0.0f) {\n\t\t// get the 2 intersection distances along ray\n\t\tGLfloat t_a = -b + sqrt(b_squared_minus_c);\n\t\tGLfloat t_b = -b - sqrt(b_squared_minus_c);\n\n\t\t// if behind viewer, throw one or both away\n\t\tif (t_a \u003c 0.0) {\n\t\t\tif (t_b \u003c 0.0) {\n\t\t\t\tintersection = false;\n\t\t\t\treturn glm::vec3(0.0f);\n\t\t\t}\n\t\t}\n\t\telse if (t_b \u003c 0.0) {\n\t\t\treturn ray_origin_wor + ray_direction_wor * t_a;\n\t\t}\n\t\telse {\n\t\t\tintersection = true;\n\t\t\treturn ray_origin_wor + ray_direction_wor * t_b;\n\t\t}\n\t}\n\n\t// check for ray hitting once (skimming the surface)\n\tif (b_squared_minus_c == 0.0f) {\n\t\t// if behind viewer, throw away\n\t\tGLfloat t = -b + sqrt(b_squared_minus_c);\n\t\tif (t \u003c 0.0f) {\n\t\t\tintersection = false;\n\t\t\treturn glm::vec3(0.0f);\n\t\t}\n\t\tintersection = true;\n\t\treturn ray_origin_wor + ray_direction_wor * t;\n\t}\n\n\t// note: could also check if ray origin is inside sphere radius\n\tintersection = false;\n\treturn glm::vec3(0.0f);\n}\n```\n\n---\n\n## Rotation\n\nNow, I'm going to implement a trackball using the picked point obtained through ray casting. Before delving into that, I've opted to use quaternions for rotation instead of Euler angles. There are several reasons for this choice. Firstly, Euler angles involve multiple rotations around each axis, which can be cumbersome. Additionally, they are sensitive to rotation order. On the contrary, quaternions overcome these issues. Moreover, quaternions are more efficient and mathematically stable for representing rotations compared to Euler angles.\n\n---\n\nThey also address certain problems associated with rotation representations, such as gimbal lock. Gimbal lock is a phenomenon where a loss of Degrees of Freedom occurs when the y-axis rotation angle approaches π/180 (approximately 1.57). This results in a noticeable occurrence, as demonstrated in the accompanying video. In the flowing video, you can observe the x-axis and z-axis rotations producing the same outcome when the y-axis rotation angle reaches the specified value.\n\n\u003ciframe width=\"560\" height=\"315\" src=\"https://www.youtube.com/embed/IVYbnSeXclE?si=S3ndvwE02ofkB0eK\" title=\"YouTube video player\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" allowfullscreen\u003e\u003c/iframe\u003e\n\n---\n\nThe following code represents a rough implementation of rotating a 3D object through mouse input. Specific implementation details can be found in the repository linked below. The rotation is achieved using quaternions to represent the orientation of the object, and it gets updated based on mouse movements. The code detects mouse input to rotate the 3D object, calculates the rotation angle, and updates the quaternion, thereby achieving smooth and intuitive rotation while avoiding issues associated with Euler angles.\n\nIn particular, the glm::normalize(pickPoint - translation) part signifies the process of normalizing the vector obtained by subtracting the current object's position (translation) from the intersection point (pickPoint) where the ray intersects with the sphere. This vector, when normalized, becomes a unit vector pointing from the object's center to the intersection point and is used as the axis of rotation. The resulting rotation axis and angle are then used to calculate the quaternion, accurately representing the object's rotation.\n\n```cpp\nbool intersection = false;\nif (mainWindow.getMouseLeft())\n{\n\tglm::vec3 ray_wor = get_ray_from_mouse(mainWindow.getCursor(), projection, camera.calculateViewMatrix());\n\tglm::vec3 pickPoint = ray_sphere(camera.getPosition(), ray_wor, translation, SPHERE_SCALE, intersection);\n\tif (intersection)\n\t{\n\t\tif (dragStartFlag) {\n\t\t\tdragStartFlag = false;\n\t\t\tprevMouseRayVector = glm::normalize(pickPoint - translation);\n\t\t}\n\t\telse {\n\t\t\tglm::vec3 currentMouseRayVector = glm::normalize(pickPoint - translation);\n\t\t\tfloat theta = glm::acos(glm::dot(prevMouseRayVector, currentMouseRayVector));\n\t\t\tif (theta \u003e 0.001f)\n\t\t\t{\n\t\t\t\tglm::vec3 axis = glm::normalize(glm::cross(prevMouseRayVector, currentMouseRayVector));\n\t\t\t\tmodelQuaternions = glm::angleAxis(theta, axis) * modelQuaternions;\n\t\t\t\tprevMouseRayVector = glm::normalize(pickPoint - translation);\n\t\t\t}\n\t\t}\n\t}\n}\nelse\n{\n\tdragStartFlag = true;\n}\n```\n\n---\n\nFor detailed implementation, please refer to the following link.\n\n[Source code](https://github.com/waynechoidev/mouse-picking-ray-tracing)\n\n---\n\n### References\n\n- [https://github.com/capnramses/antons_opengl_tutorials_book/blob/master/07_ray_picking/main.cpp](https://github.com/capnramses/antons_opengl_tutorials_book/blob/master/07_ray_picking/main.cpp)\n- [https://antongerdelan.net/opengl/raycasting.html](https://antongerdelan.net/opengl/raycasting.html)\n- [Introduction to Computer Graphics with DirectX 11 - Part 3. Rendering Techniques](https://honglab.co.kr/courses/graphicspt3)\n"])</script><script>self.__next_f.push([1,"2:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/baa01199c04a1a03.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]],[\"$\",\"$L4\",null,{\"buildId\":\"aqxnwij8molesiIkyFSsG\",\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/post/trackball/\",\"initialTree\":[\"\",{\"children\":[\"post\",{\"children\":[[\"slug\",\"trackball\",\"d\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":\\\"trackball\\\"}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialHead\":[false,\"$L5\"],\"globalErrorComponent\":\"$6\",\"children\":[null,[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"className\":\"mx-auto my-0\",\"children\":[[\"$\",\"nav\",null,{\"className\":\"max-w-default mx-auto px-5 py-3\",\"children\":[\"$\",\"$L7\",null,{}]}],[\"$\",\"header\",null,{\"children\":[\"$\",\"$L8\",null,{}]}],[\"$\",\"div\",null,{\"className\":\"max-w-default mx-auto p-5\",\"children\":[\"$\",\"$L9\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":[],\"childProp\":{\"current\":[\"$\",\"$L9\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"post\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[null,[\"$\",\"$L9\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"post\",\"children\",[\"slug\",\"trackball\",\"d\"],\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[\"$Lb\",[\"$\",\"div\",null,{\"children\":[[\"$\",\"$Lc\",null,{\"href\":\"/posts/graphics\",\"className\":\"text-gray-600 text-md pl-1 hover:font-bold\",\"children\":\"GRAPHICS\"}],[\"$\",\"h1\",null,{\"children\":\"Trackball\"}],[\"$\",\"p\",null,{\"className\":\"text-gray-400 text-sm m-0 mt-1\",\"children\":\"Nov 10, 2023\"}],[\"$\",\"div\",null,{\"className\":\"mt-1\",\"children\":[\"$\",\"div\",null,{\"className\":\"whitespace-nowrap overflow-x-auto pb-3\",\"children\":[[\"$\",\"$Lc\",\"opengl\",{\"href\":\"/tag/opengl\",\"className\":\"mr-2 text-gray-500 hover:font-bold\",\"children\":\"#opengl\"}],[\"$\",\"$Lc\",\"trackball\",{\"href\":\"/tag/trackball\",\"className\":\"mr-2 text-gray-500 hover:font-bold\",\"children\":\"#trackball\"}],[\"$\",\"$Lc\",\"picking\",{\"href\":\"/tag/picking\",\"className\":\"mr-2 text-gray-500 hover:font-bold\",\"children\":\"#picking\"}],[\"$\",\"$Lc\",\"raycasting\",{\"href\":\"/tag/raycasting\",\"className\":\"mr-2 text-gray-500 hover:font-bold\",\"children\":\"#raycasting\"}]]}]}],[\"$\",\"div\",null,{\"className\":\"mt-8\",\"children\":[\"$\",\"$Ld\",null,{\"content\":\"$e\"}]}],[\"$\",\"$Lf\",null,{\"issueTerm\":\"Trackball\"}]]}],null],\"segment\":\"__PAGE__?{\\\"slug\\\":\\\"trackball\\\"}\"},\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/602feae4669a507e.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]]}],null],\"segment\":[\"slug\",\"trackball\",\"d\"]},\"styles\":[]}],\"segment\":\"post\"},\"styles\":[]}]}],[\"$\",\"footer\",null,{\"className\":\"h-40 flex justify-center items-end\",\"children\":[\"$\",\"p\",null,{\"className\":\"text-gray-500 text-sm\",\"children\":\"(C) 2021. Wayne Choi. All rights reserved.\"}]}]]}]}],null]}]]\n"])</script><script>self.__next_f.push([1,"5:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"1\",{\"children\":\"WayneChoi.Dev\"}],[\"$\",\"meta\",\"2\",{\"name\":\"description\",\"content\":\"Wayne Choi blog\"}],[\"$\",\"meta\",\"3\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"link\",\"4\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\"}]]\nb:null\n"])</script></body></html>