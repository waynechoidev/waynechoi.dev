<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/_next/static/css/3864b451a61e4546.css" crossorigin="" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/2e2a7597edf4d608.css" crossorigin="" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/602feae4669a507e.css" crossorigin="" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-dca0e73884d124c0.js" crossorigin=""/><script src="/_next/static/chunks/fd9d1056-33f88dcb8cab817d.js" async="" crossorigin=""></script><script src="/_next/static/chunks/472-c5427e31248623a0.js" async="" crossorigin=""></script><script src="/_next/static/chunks/main-app-998ad79e34130139.js" async="" crossorigin=""></script><script src="/_next/static/chunks/326-6784f49434136418.js" async=""></script><script src="/_next/static/chunks/app/layout-02f93a462dd22bde.js" async=""></script><script src="/_next/static/chunks/d3ac728e-9e72e1d80e89da72.js" async=""></script><script src="/_next/static/chunks/149-9f0c9c044d28f14f.js" async=""></script><script src="/_next/static/chunks/app/post/%5Bslug%5D/page-dd1bc4deae325122.js" async=""></script><title>WayneChoi.Dev</title><meta name="description" content="Wayne Choi blog"/><link rel="icon" href="/favicon.ico"/><script src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js" crossorigin="" noModule=""></script></head><body class="mx-auto my-0"><nav class="max-w-default mx-auto px-5 py-3"><div class="flex justify-end"><a href="/about/"><span class="hover:font-bold pl-3 text-lg font-normal">About</span></a><a href="/posts/"><span class="hover:font-bold pl-3 text-lg font-normal">Posts</span></a></div></nav><header><div class="h-32 relative" id="sky"><canvas class="w-full h-full"></canvas><div class="absolute top-0 inset-x-auto w-full "><div class="w-full max-w-default mx-auto"><h1 class="text-4xl font-semibold p-5 pt-0"><a class="text-blue-800" href="/">WayneChoi.dev</a></h1></div></div></div></header><div class="max-w-default mx-auto p-5"><div><a class="text-gray-600 text-md pl-1 hover:font-bold" href="/posts/graphics/">GRAPHICS</a><h1>Heat equation with WebGPU</h1><p class="text-gray-400 text-sm m-0 mt-1">Aug 21, 2024</p><div class="mt-1"><div class="whitespace-nowrap overflow-x-auto pb-3"><a class="mr-2 text-gray-500 hover:font-bold" href="/tag/simulation/">#simulation</a><a class="mr-2 text-gray-500 hover:font-bold" href="/tag/webgpu/">#webgpu</a><a class="mr-2 text-gray-500 hover:font-bold" href="/tag/math/">#math</a></div></div><div class="mt-8"><div class="flex flex-col justify-center"></div></div><div><div></div></div></div></div><footer class="h-40 flex justify-center items-end"><p class="text-gray-500 text-sm">(C) 2021. Wayne Choi. All rights reserved.</p></footer><script src="/_next/static/chunks/webpack-dca0e73884d124c0.js" crossorigin="" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/css/3864b451a61e4546.css\",\"style\",{\"crossOrigin\":\"\"}]\n2:HL[\"/_next/static/css/2e2a7597edf4d608.css\",\"style\",{\"crossOrigin\":\"\"}]\n0:\"$L3\"\n"])</script><script>self.__next_f.push([1,"4:HL[\"/_next/static/css/602feae4669a507e.css\",\"style\",{\"crossOrigin\":\"\"}]\n"])</script><script>self.__next_f.push([1,"5:I[3728,[],\"\"]\n7:I[9928,[],\"\"]\n8:I[9194,[\"326\",\"static/chunks/326-6784f49434136418.js\",\"185\",\"static/chunks/app/layout-02f93a462dd22bde.js\"],\"\"]\n9:I[5629,[\"326\",\"static/chunks/326-6784f49434136418.js\",\"185\",\"static/chunks/app/layout-02f93a462dd22bde.js\"],\"\"]\na:I[6954,[],\"\"]\nb:I[7264,[],\"\"]\nd:I[8326,[\"954\",\"static/chunks/d3ac728e-9e72e1d80e89da72.js\",\"326\",\"static/chunks/326-6784f49434136418.js\",\"149\",\"static/chunks/149-9f0c9c044d28f14f.js\",\"605\",\"static/chunks/app/post/%5Bslug%5D/page-dd1bc4deae325122.js\"]"])</script><script>self.__next_f.push([1,",\"\"]\ne:I[7708,[\"954\",\"static/chunks/d3ac728e-9e72e1d80e89da72.js\",\"326\",\"static/chunks/326-6784f49434136418.js\",\"149\",\"static/chunks/149-9f0c9c044d28f14f.js\",\"605\",\"static/chunks/app/post/%5Bslug%5D/page-dd1bc4deae325122.js\"],\"\"]\n10:I[5631,[\"954\",\"static/chunks/d3ac728e-9e72e1d80e89da72.js\",\"326\",\"static/chunks/326-6784f49434136418.js\",\"149\",\"static/chunks/149-9f0c9c044d28f14f.js\",\"605\",\"static/chunks/app/post/%5Bslug%5D/page-dd1bc4deae325122.js\"],\"\"]\nf:T1e44,"])</script><script>self.__next_f.push([1,"\n\u003cimg src=\"/img/heat-equation-01.jpg\" class=\"post-pic\"/\u003e\n\n[Sample](https://waynechoidev.github.io/heat_equation/) / [Repository](https://github.com/waynechoidev/heat_equation/)\n\nThe Heat Equation is an important partial differential equation that models the phenomenon of heat conduction. I have implemented it using Compute Shaders in WebGPU. In this post, I will introduce the theoretical background of the Heat Equation, the method of solving it numerically, and how I implemented it in WGSL shader code.\n\n## Heat Equation\n\nThe Heat Equation is a partial differential equation of the following form:\n\n\u003cimg src=\"/img/heat-equation-01.svg\" class=\"latex\"/\u003e\n\nHere, u(i, j, t) represents the temperature distribution, and Œ± is the thermal conductivity. This equation describes how the distribution of heat changes over time.\n\n## Gradient\n\nThe gradient represents both the direction and magnitude of the rate of change of a vector field. In 2D, the gradient is defined as follows:\n\n\u003cimg src=\"/img/heat-equation-02.svg\" class=\"latex\"/\u003e\n\nThe gradient indicates the rate of change of the temperature distribution ùë¢ and provides the direction of the maximum temperature change at a specific point.\n\n## Divergence\n\nDivergence provides a scalar value that indicates the extent of expansion or contraction in a vector field. In 2D, divergence is defined as follows:\n\n\u003cimg src=\"/img/heat-equation-03.svg\" class=\"latex\"/\u003e\n\nHere, F is the vector field. Divergence measures how much the vector field spreads out or converges at a given point.\n\n## Laplacian\n\nThe Laplacian is defined as the divergence of the gradient and represents the curvature of a scalar field. In 2D, the Laplacian is defined as follows:\n\n\u003cimg src=\"/img/heat-equation-04.svg\" class=\"latex\"/\u003e\n\nThe Laplacian measures the rate of temperature change at a given point and is a crucial component of the Heat Equation.\n\n## Analytical Methods vs. Numerical Methods\n\nAnalytical methods involve solving mathematical equations exactly. These methods can provide precise solutions for specific equations, but they may not be practical for complex or multidimensional problems. Partial differential equations, such as the Heat Equation, are often difficult to solve analytically, which is why numerical methods are used to obtain approximate solutions.\n\nNumerical methods involve using computers to approximate solutions to equations. This approach discretizes the equations and uses iterative calculations to find approximate solutions. The advantage of numerical methods is that they are practical and efficient for finding solutions to complex problems.\n\n## Finite Difference Method\n\nThe Finite Difference Method is a prominent technique for numerically solving partial differential equations such as the Heat Equation. Here‚Äôs a general overview of the method:\n\n1. Grid Setup: Divide the problem domain into a grid. For a 2D space, this involves dividing the area into a lattice of square grid points where the temperature will be computed.\n\n2. Laplacian Calculation: Update the temperature values at each grid point. To approximate the Laplacian at each grid point, the method uses finite differences to estimate spatial changes in temperature. Below is a table showing the definitions of various differential operators used in mathematical analysis and their finite difference forms.\n\n|  Operator  |               Definition                |         Finite Difference Form          |\n| :--------: | :-------------------------------------: | :-------------------------------------: |\n|  Gradient  | \u003cimg src=\"/img/heat-equation-02.svg\" /\u003e | \u003cimg src=\"/img/heat-equation-05.svg\" /\u003e |\n| Divergence | \u003cimg src=\"/img/heat-equation-03.svg\" /\u003e | \u003cimg src=\"/img/heat-equation-06.svg\" /\u003e |\n| Laplacian  | \u003cimg src=\"/img/heat-equation-04.svg\" /\u003e | \u003cimg src=\"/img/heat-equation-07.svg\" /\u003e |\n\nGiven that the values at neighboring grid points differ by 1 unit and the grid spacing Œîx and Œîùë¶ are both 2, I simplified the finite difference formula accordingly. Here‚Äôs how I implemented it in WGSL:\n\n```js\n#include \"common.wgsl\"\n@group(0) @binding(0) var\u003cstorage, read_write\u003e srcBuffer: array\u003cf32\u003e;\n@group(0) @binding(1) var\u003cstorage, read_write\u003e divergence: array\u003cf32\u003e;\n\n@compute @workgroup_size(16, 16, 1)\nfn main(@builtin(global_invocation_id) id: vec3u) {\n    let x = id.x;\n    let y = id.y;\n    let idx = getIdx(id.xy);\n\n    let left = vec2u(clamp(x-1, 0, TEX_SIZE), y);\n    let right = vec2u(clamp(x+1, 0, TEX_SIZE), y);\n    let up = vec2u(x, clamp(y+1, 0, TEX_SIZE));\n    let down = vec2u(x, clamp(y-1, 0, TEX_SIZE));\n\n    divergence[idx] = (srcBuffer[getIdx(right)] + srcBuffer[getIdx(left)]\n    + srcBuffer[getIdx(up)] + srcBuffer[getIdx(down)] - 4 * srcBuffer[idx]) * 0.25;\n}\n```\n\n## Jacobi Method\n\nThe Jacobi Method is an iterative technique used to solve systems of linear equations, and it is applied to solve the discretized Heat Equation through finite difference methods. This method typically produces smoother results for temperature distributions. The basic procedure for the Jacobi Method is as follows:\n\n1. Compute Divergence: Before updating temperatures, calculate the divergence (or Laplacian) of the temperature field. This step involves precomputing the divergence values which will be used in the temperature update formula.\n\n2. Update Formula: Use the precomputed divergence to iteratively update the temperature values at each grid point. Here's how it can be expressed in a simplified equation through the following derivation:\n\n\u003cimg src=\"/img/heat-equation-08.svg\" class=\"latex-long\"/\u003e\n\n\u003cimg src=\"/img/heat-equation-09.svg\" class=\"latex-long\"/\u003e\n\n\u003cimg src=\"/img/heat-equation-10.svg\" class=\"latex-long\"/\u003e\n\nHere's how it was implemented in WGSL using the simplified formula. Two buffers were used and alternated for computation, and a small constant was applied to adjust the scale due to some error in the simulation.\n\n```js\n#include \"common.wgsl\"\n@group(0) @binding(0) var\u003cstorage, read_write\u003e targetBuffer: array\u003cf32\u003e;\n@group(0) @binding(1) var\u003cstorage, read_write\u003e tempBuffer: array\u003cf32\u003e;\n@group(0) @binding(2) var\u003cstorage, read_write\u003e divergence: array\u003cf32\u003e;\n\n@compute @workgroup_size(16, 16, 1)\nfn main(@builtin(global_invocation_id) id: vec3u) {\n    let x = id.x;\n    let y = id.y;\n    let idx = getIdx(id.xy);\n\n    let left = vec2u(clamp(x-1, 0, TEX_SIZE), y);\n    let right = vec2u(clamp(x+1, 0, TEX_SIZE), y);\n    let up = vec2u(x, clamp(y+1, 0, TEX_SIZE));\n    let down = vec2u(x, clamp(y-1, 0, TEX_SIZE));\n\n    let divergetmzpdlfnceScale = 0.25;\n\n    targetBuffer[idx] = (tempBuffer[getIdx(right)] + tempBuffer[getIdx(left)]\n    + tempBuffer[getIdx(up)] + tempBuffer[getIdx(down)] - divergence[idx] * 4.0 * divergenceScale) * 0.25;\n}\n```\n\n## Conclusion\n\nThe numerical approach to the Heat Equation is an effective method for solving complex problems where analytical solutions are difficult to obtain. By approximating spatial changes through finite difference methods and employing iterative techniques such as the Jacobi Method to solve linear equations, the Heat Equation can be approached practically. These numerical approaches can be applied not only to fluid simulations but also to various physical phenomena such as heat conduction and electric field calculations.\n\n### References\n\n- [Introduction to Computer Graphics with DirectX 11 - Part 4. Computer Animation](https://honglab.co.kr/courses/graphicspt4)\n- [GPU Gems](https://developer.nvidia.com/gpugems/gpugems/part-vi-beyond-triangles/chapter-38-fast-fluid-dynamics-simulation-gpu)\n- [Wikipedia](\u003chttps://en.wikipedia.org/wiki/Projection_method_(fluid_dynamics)\u003e)\n- [Real-Time Fluid Dynamics for Games - Jos Stam](http://graphics.cs.cmu.edu/nsp/course/15-464/Fall09/papers/StamFluidforGames.pdf)\n"])</script><script>self.__next_f.push([1,"3:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/3864b451a61e4546.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}],[\"$\",\"link\",\"1\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/2e2a7597edf4d608.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]],[\"$\",\"$L5\",null,{\"buildId\":\"d1tlILPvfFQtQusXyx6Vm\",\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/post/heat-equation/\",\"initialTree\":[\"\",{\"children\":[\"post\",{\"children\":[[\"slug\",\"heat-equation\",\"d\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":\\\"heat-equation\\\"}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialHead\":[false,\"$L6\"],\"globalErrorComponent\":\"$7\",\"children\":[null,[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"className\":\"mx-auto my-0\",\"children\":[[\"$\",\"nav\",null,{\"className\":\"max-w-default mx-auto px-5 py-3\",\"children\":[\"$\",\"$L8\",null,{}]}],[\"$\",\"header\",null,{\"children\":[\"$\",\"$L9\",null,{}]}],[\"$\",\"div\",null,{\"className\":\"max-w-default mx-auto p-5\",\"children\":[\"$\",\"$La\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"template\":[\"$\",\"$Lb\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":[],\"childProp\":{\"current\":[\"$\",\"$La\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"post\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"template\":[\"$\",\"$Lb\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[null,[\"$\",\"$La\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"post\",\"children\",[\"slug\",\"heat-equation\",\"d\"],\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"template\":[\"$\",\"$Lb\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[\"$Lc\",[\"$\",\"div\",null,{\"children\":[[\"$\",\"$Ld\",null,{\"href\":\"/posts/graphics\",\"className\":\"text-gray-600 text-md pl-1 hover:font-bold\",\"children\":\"GRAPHICS\"}],[\"$\",\"h1\",null,{\"children\":\"Heat equation with WebGPU\"}],[\"$\",\"p\",null,{\"className\":\"text-gray-400 text-sm m-0 mt-1\",\"children\":\"Aug 21, 2024\"}],[\"$\",\"div\",null,{\"className\":\"mt-1\",\"children\":[\"$\",\"div\",null,{\"className\":\"whitespace-nowrap overflow-x-auto pb-3\",\"children\":[[\"$\",\"$Ld\",\"simulation\",{\"href\":\"/tag/simulation\",\"className\":\"mr-2 text-gray-500 hover:font-bold\",\"children\":\"#simulation\"}],[\"$\",\"$Ld\",\"webgpu\",{\"href\":\"/tag/webgpu\",\"className\":\"mr-2 text-gray-500 hover:font-bold\",\"children\":\"#webgpu\"}],[\"$\",\"$Ld\",\"math\",{\"href\":\"/tag/math\",\"className\":\"mr-2 text-gray-500 hover:font-bold\",\"children\":\"#math\"}]]}]}],[\"$\",\"div\",null,{\"className\":\"mt-8\",\"children\":[\"$\",\"$Le\",null,{\"content\":\"$f\"}]}],[\"$\",\"$L10\",null,{\"issueTerm\":\"Heat equation with WebGPU\"}]]}],null],\"segment\":\"__PAGE__?{\\\"slug\\\":\\\"heat-equation\\\"}\"},\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/602feae4669a507e.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]]}],null],\"segment\":[\"slug\",\"heat-equation\",\"d\"]},\"styles\":[]}],\"segment\":\"post\"},\"styles\":[]}]}],[\"$\",\"footer\",null,{\"className\":\"h-40 flex justify-center items-end\",\"children\":[\"$\",\"p\",null,{\"className\":\"text-gray-500 text-sm\",\"children\":\"(C) 2021. Wayne Choi. All rights reserved.\"}]}]]}]}],null]}]]\n"])</script><script>self.__next_f.push([1,"6:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"1\",{\"children\":\"WayneChoi.Dev\"}],[\"$\",\"meta\",\"2\",{\"name\":\"description\",\"content\":\"Wayne Choi blog\"}],[\"$\",\"meta\",\"3\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"link\",\"4\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\"}]]\nc:null\n"])</script></body></html>